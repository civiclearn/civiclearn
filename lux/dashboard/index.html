<!doctype html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CivicLearn ‚Äî Dashboard</title>

  <!-- Fonts + Core CivicEdge Styles -->
  <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/dashboard-core-lt.css">
  <!-- Flag size override -->
  <style>
    .brand svg {
      width: 30px !important;
      height: 30px !important;
    }
  </style>
<style>

  #factText {
    flex-grow: 0 !important;
    margin-bottom: 16px; /* space before the question */
  }
</style>
<style>

.db-metric-card:has(#topicsChart) {
    min-width: 500px !important; 
    width: 500px;
}

</style>
<style>
/* LU ‚Äì Fact of the Day compact override */
#db-metrics-row .fact-card {
  padding: 22px 20px !important;
  max-height: none !important;
}

#factQuestion {
  font-size: 0.85rem !important;
  line-height: 1.4 !important;
  margin-bottom: 14px !important;
}

.fact-options {
  gap: 8px !important;
}

.fact-option-btn {
  min-height: 42px !important;
  font-size: 0.8rem !important;
  padding: 8px 14px !important;
}

.fact-footer {
  padding-top: 16px !important;
  gap: 32px !important;
}

.fact-side-btn {
  width: 38px !important;
  height: 38px !important;
  font-size: 16px !important;
}
</style>

  <script>
  document.documentElement.classList.add("i18n-hidden");
</script>

  <!-- 1. Supabase project config (safe to load early) -->
  <script>
    window.SUPABASE_URL = "https://htgliokekeaovdiafrgs.supabase.co";
    window.SUPABASE_KEY = "sb_publishable_QWvR124i4h0hvQumyjBgDw_018SlMbp";
  </script>

  <!-- 2. Load Supabase UMD dynamically and only then create client -->
  <script>
    const supabaseLoader = document.createElement("script");
    supabaseLoader.src = "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.7.1/dist/umd/supabase.js";

    supabaseLoader.onload = () => {
      window.supabase = supabase.createClient(window.SUPABASE_URL, window.SUPABASE_KEY);
    };

    document.head.appendChild(supabaseLoader);
  </script>

  <!-- 3. Auth guard ‚Äî safe, because it waits for window.supabase -->
  <script src="/assets/js/auth-guardS.js"></script>
 
</head>

<body class="dashboard">
  <button class="menu-toggle" aria-label="Menu">‚ò∞</button>
  <div class="wrap">
   <!-- SIDEBAR -->
<aside class="sidebar">
<div class="brand">
  CivicLearn¬Æ
  <svg
    viewBox="0 0 12000 6000"
    width="30"
    height="30"
    style="margin-left:6px;vertical-align:middle;border-radius:3px;overflow:hidden"
    aria-label="Luxembourg"
  >
    <defs>
      <clipPath id="clip-lu">
        <rect width="12000" height="6000" />
      </clipPath>
    </defs>

    <g clip-path="url(#clip-lu)">
      <!-- Top: Red -->
      <rect x="0" y="0" width="12000" height="2000" fill="#ED2939"/>

      <!-- Middle: White -->
      <rect x="0" y="2000" width="12000" height="2000" fill="#FFFFFF"/>

      <!-- Bottom: Light Blue -->
      <rect x="0" y="4000" width="12000" height="2000" fill="#00A1DE"/>
    </g>
  </svg>
</div>





          <nav class="nav">
  <a href="index.html" class="sub active" data-i18n="nav_dashboard"></a>
  <a href="simulation.html" data-i18n="nav_simulation"></a>
  <a href="quick.html" data-i18n="nav_quick"></a>
  <a href="topics.html" data-i18n="nav_topics"></a>
  <a href="traps.html" data-i18n="nav_traps"></a>
  <a href="flashcards.html" data-i18n="nav_flashcards"></a>
  <a href="reference.html"  data-i18n="nav_reference_texts"></a>
  <a href="history.html"   data-i18n="nav_history"></a>
  <a href="my-list.html" data-i18n="nav_my_list"></a>
  <a href="help.html" data-i18n="nav_help"></a>
  <a href="#" data-i18n="nav_logout" id="logoutLink"></a>
</nav>


  <div class="spacer"></div>

<div class="profile">


    <!-- LANGUAGE SWITCHER -->
<div class="lang-switch">
  <button data-lang="fr">FR</button>
  <button data-lang="de">DE</button>
  <button data-lang="en">EN</button>
</div>

 <div class="profile-info">

    <!-- READING TOGGLE -->
    <div class="reading-inline">
      <span data-i18n="reading_label"></span>
      <button id="readingToggle"
              class="reading-btn inline"
              data-i18n="reading_tooltip"
              data-i18n-attr="title">üîá</button>
    </div>

  </div>
</div>





</aside>
<!-- MOBILE OVERLAY -->
<div class="overlay" id="menuOverlay"></div>

<!-- MAIN -->
<main class="main">

<div class="db-main">

  <!-- TOP METRICS -->
  <div class="db-top-metrics">

    <!-- Countdown -->
<div class="db-metric-tile mobile-essential" id="countdownCard">
  <div id="examCountdown" class="db-metric-value" style="display:none;">J-0</div>

  <div id="examNoDate" class="db-metric-label" data-i18n="countdown_enter_date"></div>

  <div id="openDateSheet" class="db-metric-label date-edit-link" data-i18n="countdown_set_date_btn"></div>
</div>


  <!-- Answered Questions -->
  <div class="db-metric-tile">
    <div id="tmAnswered" class="db-metric-value mobile-essential">0</div>
    <div class="db-metric-label" data-i18n="dashboard_answered_questions">
    </div>
  </div>

  <!-- Global Accuracy -->
  <div class="db-metric-tile mobile-hide">
    <div id="tmAccuracy" class="db-metric-value">0%</div>
    <div class="db-metric-label" data-i18n="dashboard_global_accuracy">
    </div>
  </div>

  <!-- Total Study Time -->
  <div class="db-metric-tile mobile-hide">
    <div id="tmTime" class="db-metric-value">0h 00m</div>
    <div class="db-metric-label" data-i18n="dashboard_total_study_time">
    </div>
  </div>

  <!-- Streak -->
  <div class="db-metric-tile mobile-hide">
    <div id="tmStreak" class="db-metric-value"></div>
    <div class="db-metric-label" data-i18n="dashboard_streak">
    </div>
  </div>

</div>



<!-- LAUNCHERS GRID -->
<section class="db-grid">

<!-- Reference texts -->
<div class="db-card mobile-hide">
  <div>
    <div class="db-icon">üìÑ</div>
    <h3 data-i18n="reference_texts_title"></h3>
    <p data-i18n="short_reference_texts_subtitle"></p>
  </div>
  <a class="db-btn"
     href="reference.html"
     data-i18n="reference_texts_btn"></a>
</div>

  <!-- Timed Simulation -->
  <div class="db-card mobile-essential mobile-launcher">
    <div>
      <div class="db-icon">‚è±Ô∏è</div>
      <h3 data-i18n="launcher_sim_title"></h3>
      <p data-i18n="launcher_sim_sub"></p>
    </div>
    <a class="db-btn" href="simulation.html" data-i18n="launcher_btn_start"></a>
  </div>

  <!-- Quick Test -->
  <div class="db-card mobile-essential mobile-launcher">
    <div>
      <div class="db-icon">‚ö°</div>
      <h3 data-i18n="launcher_quick_title"></h3>
      <p data-i18n="launcher_quick_sub"></p>
    </div>
    <a class="db-btn" href="quick.html" data-i18n="launcher_btn_start"></a>
  </div>

  <!-- Test √† la mesure -->
  <div class="db-card mobile-hide">
    <div>
      <div class="db-icon">üß™</div>
      <h3 data-i18n="launcher_topics_title"></h3>
      <p data-i18n="launcher_topics_sub"></p>
    </div>
    <a class="db-btn" href="topics.html" data-i18n="launcher_btn_start"></a>
  </div>

  <!-- Frequent Traps -->
  <div class="db-card mobile-hide">
    <div>
      <div class="db-icon">üö´</div>
      <h3 data-i18n="launcher_traps_title"></h3>
      <p data-i18n="launcher_traps_sub"></p>
    </div>
    <a class="db-btn" href="traps.html" data-i18n="launcher_btn_open"></a>
  </div>

  <!-- History -->
  <div class="db-card mobile-hide">
    <div>
      <div class="db-icon">üìä</div>
      <h3 data-i18n="launcher_history_title"></h3>
      <p data-i18n="launcher_history_sub"></p>
    </div>
    <a class="db-btn" href="history.html" data-i18n="launcher_btn_open"></a>
  </div>

</section>


<!-- MOBILE-ONLY MINI LAUNCHERS -->
<section class="db-grid-mini mobile-only">
  <div class="db-mini-card">
    <div class="db-mini-icon">‚è±Ô∏è</div>
    <div class="db-mini-title">Simulation</div>
    <a class="db-mini-btn" href="simulation.html">D√©marrer</a>
  </div>

  <div class="db-mini-card">
    <div class="db-mini-icon">‚ö°</div>
    <div class="db-mini-title">Test rapide</div>
    <a class="db-mini-btn" href="quick.html">Lancer</a>
  </div>
</section>


<!-- THREE CHARTS -->
<section id="db-metrics-row">

  <!-- Global mastery donut -->
  <div class="db-metric-card mobile-essential">
    <div class="globalChartWrap">
      <canvas id="globalChart"></canvas>
    </div>
    <div><strong id="globalPct">0%</strong> <span data-i18n="dashboard_mastered_label"></span></div>
    <div id="globalAnswered" class="muted" data-i18n="dashboard_questions_label"></div>
  </div>

  <!-- Topics chart -->
  <div class="db-metric-card mobile-hide">
    <canvas id="topicsChart"></canvas>
    <div class="topics-legend">
      <div class="topics-legend-title" data-i18n="dashboard_topics_legend_title"></div>
      <div class="topics-legend-sub" id="topicsCountLabel"></div>
    </div>
  </div>

<div class="db-metric-card fact-card" id="factOfDayCard">
  
  <span id="factDate" style="display:none;"></span>
  <h3 id="factTitle" style="display:none;"></h3>
  <p id="factText" style="display:none;"></p>

  <div id="factQuestionBlock">
    <p id="factQuestion">Loading question...</p>
  </div>

  <div id="factOptions" class="fact-options"></div>

  <div class="fact-footer">
    <button id="factPrev" class="fact-side-btn">‚Üê</button>
    <button id="factNext" class="fact-side-btn">‚Üí</button>
  </div>

  <div id="factFeedback" style="display:none;"></div>
</div>



</section>


     <footer class="db-footer">
     ¬© <span id="year"></span> ‚Äî CivicLearn by Testrada ‚Äî All rights reserved.
    </footer>

  </div>

</main>
<!-- === Bottom Sheet for Exam Date Picker === -->
<div id="dateSheetOverlay" class="sheet-overlay"></div>

<div id="dateSheet" class="sheet">
  <div class="sheet-header">
    <h3 data-i18n="Choisir la date du test"</h3>
  </div>

  <div class="sheet-body">
    <input type="date" id="examDateInput" />
  </div>

  <div class="sheet-actions">
    <button id="sheetCancel" class="primary" data-i18n="dashboard_datepicker_cancel"></button>
    <button id="sheetSave" class="primary" data-i18n="dashboard_datepicker_confirm"></button>
  </div>
</div>

<!-- === MOBILE MENU TOGGLE === -->
<script>
  document.addEventListener("DOMContentLoaded", () => {
    const toggle = document.querySelector(".menu-toggle");
    const overlay = document.querySelector(".overlay");
    if (toggle && overlay) {
      toggle.addEventListener("click", () => {
        document.body.classList.toggle("menu-open");
      });
      overlay.addEventListener("click", () => {
        document.body.classList.remove("menu-open");
      });
    }
  });
</script>

<script src="/assets/js/i18n.js"></script>
<script src="/assets/js/lang-bootstrap-lu.js"></script>
<script src="/assets/js/config-lu.js"></script>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="/assets/js/reading.js"></script>
<script src="/assets/js/engine-lu.js"></script>

<script>
  document.addEventListener("DOMContentLoaded", async () => {
    await CivicLearnI18n.init();
    document.documentElement.classList.remove("i18n-hidden");
  });
</script>

<script>
function loadFactOfDay() {
  const s2 = document.createElement("script");
  s2.src = "/assets/js/factofday-lu.js";
  document.body.appendChild(s2);
}

CivicLearnI18n.onReady(() => {
  const s1 = document.createElement("script");
  s1.src = "/assets/js/dashboard-v2-lu.js";
  document.body.appendChild(s1);



  // If DOM is already ready, run instantly
  if (document.readyState === "complete" || document.readyState === "interactive") {
    loadFactOfDay();
  } else {
    document.addEventListener("DOMContentLoaded", loadFactOfDay);
  }
});
</script>

<script>
  // Plan B: Force Chrome to flush any delayed textContent DOM updates
  CivicLearnI18n.onReady(() => {
    setTimeout(() => {
      // touch one translated node, causing forced reflow
      const test = document.querySelector('[data-i18n]');
      if (test) {
        const tmp = test.textContent;
        test.textContent = tmp; // write same value
      }
    }, 50);
  });
</script>
<script>
  document.getElementById("year").textContent = new Date().getFullYear();
</script>
<script>
  (function () {
    const current = window.CIVICEDGE_LANG;

    document.querySelectorAll(".lang-switch button").forEach(btn => {
      const lang = btn.dataset.lang;

      // Highlight active language
      if (lang === current) {
        btn.classList.add("active");
      }

      btn.addEventListener("click", () => {
        if (lang === current) return;
        localStorage.setItem("civicedge_lang", lang);
        location.reload();
      });
    });
  })();
</script>

<script src="/assets/js/signout.js"></script>
</body>
</html>

