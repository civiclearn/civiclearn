<!DOCTYPE html>
<html lang="fr-LU">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>CivicLearn ‚Äì Paiement s√©curis√©</title>

  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="/assets/css/checkout.css">

  <style>
    .checkout-header .lang-switch {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .checkout-header .lang-switch button {
      min-width: 38px;
      height: 32px;
      padding: 0 10px;
      border-radius: 10px;
      border: 1px solid #d8d6e3;
      background: #f6f5fb;
      color: #2d2b38;
      font-family: inherit;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
    }
    .checkout-header .lang-switch button.active {
      background: #6b4eff;
      color: #fff;
      border-color: #6b4eff;
      box-shadow: 0 4px 12px rgba(107,78,255,.25);
    }
  </style>
</head>

<body>

<header class="checkout-header">
  <div class="checkout-header-inner">
    <div class="checkout-brand">
      <img src="/assets/images/lu.svg" alt="Luxembourg">
      <span data-t="brand_title"></span>
    </div>
	
    <div class="checkout-right">
      <div class="lang-switch">
        <button data-lang="fr">FR</button>
        <button data-lang="de">DE</button>
        <button data-lang="en">EN</button>
      </div>
    </div>
  </div>
</header>

<main>
  <div class="layout">

    <!-- LEFT CARD -->
    <aside class="features">
      <h2 data-t="plan_title"></h2>
      <div class="price" data-t="plan_price"></div>
      <div class="once" data-t="plan_once"></div>

      <div class="divider"></div>

      <h3 data-t="included_title"></h3>

      <ul class="benefits">
        <li data-t="benefit_1"></li>
        <li data-t="benefit_2"></li>
        <li data-t="benefit_3"></li>
        <li data-t="benefit_4"></li>
        <li data-t="benefit_5"></li>
        <li data-t="benefit_6"></li>
        <li data-t="benefit_7"></li>
        <li data-t="benefit_8"></li>
        <li data-t="benefit_9"></li>
        <li data-t="benefit_10"></li>
        <li data-t="benefit_11"></li>
        <li data-t="benefit_12"></li>
      </ul>

      <p class="recommend" data-t="social_proof"></p>
    </aside>

    <!-- RIGHT CARD -->
    <section class="right">
      <div class="checkout-card">

        <h1 data-t="checkout_title"></h1>
        <div class="secure-line" data-t="secure_line"></div>

        <div class="checkout-flow">

          <!-- STEP 1 -->
          <div class="checkout-step" id="stepInitial">
            <button class="pay-btn" id="startCheckout" data-t="cta_start"></button>
            <p class="small-note" data-t="note_redirect"></p>
          </div>

          <!-- STEP 2 -->
          <div class="checkout-step" id="stepEmail" hidden>
            <p class="email-instructions" data-t="email_instruction"></p>

            <div class="email-field-group">
              <label for="checkoutEmail" data-t="email_label"></label>
              <input
                id="checkoutEmail"
                type="email"
                placeholder="you@example.com"
                autocomplete="email"
              />
            </div>

            <button class="pay-btn" id="continueWithEmail" data-t="cta_continue"></button>
          </div>

          <!-- STEP 3 -->
          <div class="checkout-step" id="stepConfirm" hidden>
            <p data-t="confirm_text"></p>
            <p class="email-display" id="emailDisplay"></p>
            <p class="confirm-warning" data-t="confirm_warning"></p>

            <div class="confirm-actions">
              <button class="pay-btn" id="confirmEmail" data-t="cta_confirm"></button>
              <button class="link-btn" id="editEmail" data-t="cta_edit"></button>
            </div>
          </div>

          <div id="checkoutMessage" class="checkout-message"></div>
        </div>

        <div class="trust">
          <div>üîí <span data-t="trust_secure"></span></div>
          <div>‚ö° <span data-t="trust_instant"></span></div>
          <div>‚úî <span data-t="trust_no_sub"></span></div>
        </div>

        <div class="after-text">
          <span data-t="already_account"></span>
          <a href="/lux/login.html" data-t="login_link"></a>
        </div>

      </div>
    </section>

  </div>
</main>

<!-- =========================
     I18N DICTIONARY
========================= -->
<script>
const I18N = {
  fr: {
    brand_title: "Vivre-Ensemble",
    plan_title: "Acc√®s Premium",
    plan_price: "69 EUR",
    plan_once: "Paiement unique ¬∑ acc√®s √† vie",

    included_title: "Inclus",
    benefit_1: "Questions conformes au test Vivre-Ensemble",
    benefit_2: "Institutions, droits et devoirs",
    benefit_3: "Culture civique luxembourgeoise",
    benefit_4: "Histoire et soci√©t√© du Luxembourg",
    benefit_5: "Sessions courtes et cibl√©es",
    benefit_6: "Simulations r√©alistes",
    benefit_7: "Regroupement automatique des questions difficiles",
    benefit_8: "Suivi de progression par th√®me",
    benefit_9: "Statistiques d√©taill√©es",
    benefit_10: "Historique complet",
    benefit_11: "Rappels optionnels",
    benefit_12: "Acc√®s imm√©diat apr√®s paiement",

    social_proof: "Utilis√© par des candidats ayant r√©ussi le test Vivre-Ensemble.",

    checkout_title: "Activer l‚Äôacc√®s Premium",
    secure_line: "Paiement 100 % s√©curis√© via Stripe",

    cta_start: "Continuer vers le paiement s√©curis√©",
    note_redirect: "Vous serez redirig√© vers Stripe.",

    email_instruction: "Entrez l‚Äôadresse e-mail utilis√©e pour votre compte.",
    email_label: "Adresse e-mail",
    cta_continue: "Continuer",

    confirm_text: "Le compte sera cr√©√© avec cette adresse :",
    confirm_warning: "V√©rifiez attentivement. Le lien de connexion sera envoy√© √† cette adresse.",
    cta_confirm: "Oui, continuer",
    cta_edit: "Modifier",

    trust_secure: "Paiement s√©curis√©",
    trust_instant: "Acc√®s imm√©diat",
    trust_no_sub: "Sans abonnement",

    already_account: "D√©j√† un compte ?",
    login_link: "Se connecter",

    msg_enter_email: "Adresse e-mail requise.",
    msg_invalid_email: "Adresse e-mail invalide.",
    msg_connecting: "Connexion √† Stripe‚Ä¶",
    msg_error: "Une erreur est survenue."
  },

  de: {
    brand_title: "Vivre-Ensemble",
    plan_title: "Premium-Zugang",
    plan_price: "69 EUR",
    plan_once: "Einmalzahlung ¬∑ lebenslanger Zugriff",

    included_title: "Enthalten",
    benefit_1: "Fragen gem√§√ü Vivre-Ensemble-Test",
    benefit_2: "Institutionen, Rechte und Pflichten",
    benefit_3: "Staatsb√ºrgerkunde Luxemburgs",
    benefit_4: "Geschichte und Gesellschaft",
    benefit_5: "Kurze Lerneinheiten",
    benefit_6: "Realistische Simulationen",
    benefit_7: "Automatische Sammlung schwieriger Fragen",
    benefit_8: "Fortschritt nach Themen",
    benefit_9: "Detaillierte Statistiken",
    benefit_10: "Vollst√§ndiger Verlauf",
    benefit_11: "Optionale Erinnerungen",
    benefit_12: "Sofortiger Zugriff nach Zahlung",

    social_proof: "Von erfolgreichen Kandidaten genutzt.",

    checkout_title: "Premium-Zugang aktivieren",
    secure_line: "100 % sichere Zahlung √ºber Stripe",

    cta_start: "Weiter zur sicheren Zahlung",
    note_redirect: "Weiterleitung zu Stripe.",

    email_instruction: "E-Mail-Adresse eingeben.",
    email_label: "E-Mail",
    cta_continue: "Weiter",

    confirm_text: "Das Konto wird mit dieser Adresse erstellt:",
    confirm_warning: "Bitte sorgf√§ltig pr√ºfen.",
    cta_confirm: "Ja, fortfahren",
    cta_edit: "√Ñndern",

    trust_secure: "Sichere Zahlung",
    trust_instant: "Sofortiger Zugriff",
    trust_no_sub: "Keine Abos",

    already_account: "Bereits ein Konto?",
    login_link: "Anmelden",

    msg_enter_email: "E-Mail erforderlich.",
    msg_invalid_email: "Ung√ºltige E-Mail-Adresse.",
    msg_connecting: "Verbindung zu Stripe‚Ä¶",
    msg_error: "Ein Fehler ist aufgetreten."
  },

  en: {
    brand_title: "Vivre-Ensemble",
    plan_title: "Premium access",
    plan_price: "69 EUR",
    plan_once: "One-time payment ¬∑ lifetime access",

    included_title: "Included",
    benefit_1: "Questions aligned with the Vivre-Ensemble test",
    benefit_2: "Institutions, rights and duties",
    benefit_3: "Luxembourg civic knowledge",
    benefit_4: "History and society",
    benefit_5: "Short focused sessions",
    benefit_6: "Realistic simulations",
    benefit_7: "Automatic regrouping of difficult questions",
    benefit_8: "Progress tracking by topic",
    benefit_9: "Detailed statistics",
    benefit_10: "Full history",
    benefit_11: "Optional reminders",
    benefit_12: "Instant access after payment",

    social_proof: "Used by successful candidates.",

    checkout_title: "Activate Premium access",
    secure_line: "100% secure payment via Stripe",

    cta_start: "Continue to secure payment",
    note_redirect: "You will be redirected to Stripe.",

    email_instruction: "Enter the email used for your account.",
    email_label: "Email",
    cta_continue: "Continue",

    confirm_text: "The account will be created with this email:",
    confirm_warning: "Please verify carefully.",
    cta_confirm: "Yes, continue",
    cta_edit: "Edit",

    trust_secure: "Secure payment",
    trust_instant: "Instant access",
    trust_no_sub: "No subscription",

    already_account: "Already have an account?",
    login_link: "Log in",

    msg_enter_email: "Email required.",
    msg_invalid_email: "Invalid email address.",
    msg_connecting: "Connecting to Stripe‚Ä¶",
    msg_error: "An error occurred."
  }
};
</script>

<!-- =========================
     I18N ENGINE
========================= -->
<script>
let currentLang = "fr";

function applyLang(lang) {
  currentLang = lang;
  localStorage.setItem("lang", lang);
  document.documentElement.lang = lang;

  document.querySelectorAll(".lang-switch button").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });

  document.querySelectorAll("[data-t]").forEach(el => {
    const key = el.getAttribute("data-t");
    if (I18N[lang][key]) el.textContent = I18N[lang][key];
  });
}

document.querySelectorAll(".lang-switch button").forEach(btn => {
  btn.addEventListener("click", () => applyLang(btn.dataset.lang));
});

applyLang(currentLang);
</script>

<!-- =========================
     CHECKOUT LOGIC
========================= -->
<script>
(function () {
  const stepInitial = document.getElementById("stepInitial");
  const stepEmail = document.getElementById("stepEmail");
  const stepConfirm = document.getElementById("stepConfirm");

  const startBtn = document.getElementById("startCheckout");
  const continueBtn = document.getElementById("continueWithEmail");
  const confirmBtn = document.getElementById("confirmEmail");
  const editBtn = document.getElementById("editEmail");

  const emailInput = document.getElementById("checkoutEmail");
  const emailDisplay = document.getElementById("emailDisplay");
  const msgBox = document.getElementById("checkoutMessage");

  let currentEmail = "";

  function showMessage(type, text) {
    msgBox.className = "checkout-message " + type;
    msgBox.textContent = text;
    msgBox.style.display = "block";
  }

  function validateEmail(val) {
    const email = val.trim();
    if (!email) return { ok: false, msg: I18N[currentLang].msg_enter_email };
    if (!/^[^@\s]+@[^@\s]+\.[^@\s]+$/.test(email)) {
      return { ok: false, msg: I18N[currentLang].msg_invalid_email };
    }
    return { ok: true, email };
  }

  startBtn.onclick = () => {
    stepInitial.hidden = true;
    stepEmail.hidden = false;
    emailInput.focus();
  };

  continueBtn.onclick = () => {
    const res = validateEmail(emailInput.value);
    if (!res.ok) return showMessage("error", res.msg);
    currentEmail = res.email;
    emailDisplay.textContent = currentEmail;
    stepEmail.hidden = true;
    stepConfirm.hidden = false;
  };

  editBtn.onclick = () => {
    stepConfirm.hidden = true;
    stepEmail.hidden = false;
  };

  confirmBtn.onclick = async () => {
    showMessage("info", I18N[currentLang].msg_connecting);

    try {
      const r = await fetch("https://payments.civiclearn.com/create-checkout-session", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          email: currentEmail,
          product: "lux-vivre-ensemble-premium"
        })
      });

      if (!r.ok) throw new Error();
      const data = await r.json();
      window.location.href = data.url;

    } catch {
      showMessage("error", I18N[currentLang].msg_error);
    }
  };
})();
</script>

</body>
</html>
