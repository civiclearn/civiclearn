<!DOCTYPE html>
<html lang="fr-FR">
<head>
  <meta charset="UTF-8" />
  <title>Redirection…</title>

  <script>
    window.SUPABASE_URL = "https://htgliokekeaovdiafrgs.supabase.co";
    window.SUPABASE_KEY = "sb_publishable_QWvR124i4h0hvQumyjBgDw_018SlMbp";
  </script>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.7.1/dist/umd/supabase.js"></script>
</head>

<body>
<script>
const supabaseClient = supabase.createClient(
  window.SUPABASE_URL,
  window.SUPABASE_KEY
);

async function redirectAfterLogin(session) {
  if (!session || !session.user) {
    window.location.replace("/france/login.html");
    return;
  }

  const { data, error } = await supabaseClient
    .from("users")
    .select("access_path")
    .eq("id", session.user.id)
    .single();

  if (error || !data?.access_path) {
    window.location.replace("/france/checkout.html");
    return;
  }

  window.location.replace(data.access_path);
}

// ✅ wait for auth to be ready
supabaseClient.auth.onAuthStateChange((event, session) => {
  if (event === "SIGNED_IN") {
    redirectAfterLogin(session);
  }
});

// fallback if session already exists
(async () => {
  const { data } = await supabaseClient.auth.getSession();
  if (data.session) {
    redirectAfterLogin(data.session);
  }
})();
</script>
</body>
</html>
